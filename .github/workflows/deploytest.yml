name: deploy test

on:
  push:

jobs:
  run-script:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set environment variable (for tput command)
      run: echo "TERM=xterm" >> $GITHUB_ENV

    - name: Run install script
      run: |
        sudo chmod 555 ./a.sh
        sed -i 's/git_repository=github_actions/git_repository=https:\/\/github.com\/misskey-dev\/misskey/' ./testenv_githubactions.txt
        sed -i 's/git_branch=github_actions/git_branch=master/' ./testenv_githubactions.txt
        sudo bash -x ./a.sh -c ./testenv_githubactions.txt
      env:
        GITHUB_WORKSPACE: $GITHUB_WORKSPACE
